# UE_vehicle_example

task:
адача - нужно сделать drivable систему на болид для Unreal Engine начиная с версии 4.27. 

Помимо возможности управлять автомобилем необходимо что бы были реализованы функции:

1. Включить/выключить фары;
2. При вращении колес вращался руль;
3. Задние фары реагировали на торможение;
4. Возможность кастомизации - замены рулей, деталей автомобиля (передних и задних спойлеров) и текстур;
5. При торможении на асфальте должны появляться следы от колес.

Важно что бы физика автомобиля соответствовала реальному болиду по характеру поведения подвески и особенностей управления.

## time spent:
17.01 - 13:00 -> 19:20

18.01 - 9:00 -> 21:50 - 00:20

19.01 - 09:20 -> 15:00

all time spent: ~~23:30
MVP result video: https://youtu.be/pnrgo59HWJI
MVP development build: https://drive.google.com/drive/folders/14TGlnrqJo2biz9raHGHBSOPOt_atgaOp?usp=sharing

## Задачи и проблемы

_Раздел предназначен для демонстрации хода мысли во время выполнения задания_

**17.01**

* Задачи

Разобраться с ассетом, импортировать и создать черновик bp с chaos vehicle // 13:00 > 19:20

* Проблемы/решения

Ассет в блендере без натянутых текстур - натянем в движке после того как поймем что работает база

Нету рига под chaos vehicle - использую предлагаемый плагин но возникают проблемы с переносом всех мешей сцены в один скелет. Не понимаю как это должно правильно работать, закапываться не буду чтобы не тратить много времени.

Пытаемся завести чтобы работало на колесах + дне -> неработает физика для блупринта основаном на скелете, не решается с помощью симпл коллизии

**18.01**

* Задачи

Решить проблему с физикой блупринта основанного на скелете // 09:00 -> 10:30

Сделать первую болванку для езды // 10:30 -> 11:40

Собрать и раскрасить болид // 11:40 -> 12:40

Тюнинг физики // 12:40 -> 15:30

Следы торможения // 15:30 -> 16:50 

Сделать движение руля вместе с колесами // 16:50 -> 18:10 ; 20:20 -> 21:50

Задний свет при тормозе, фара, фикс джитера (моушн блюр на колесах) // 18:30 -> 20:20




* Проблемы/решения

Проблемы с физикой заключаются где-то в Physics type меша. Если использовать дефолт, то гравитация применяется, если кинематик как рекомендуют во всех гайдах - нет.

//
If you're attempting to follow this tutorial in UE4, note that when you switch your wheel simulation type to Kinematic, the vehicle will no longer fall in simulation or in game. But it will work in UE5. I don't know how the chaos vehicle plugin is supposed to work in 4.
//


При учете что мы делаем ассет для для версий 4.27 и старше - думаем дальше

Установил 4.27 chaos, похоже все начало работать близко к нужному результату. продолжаем с ним.
В 4.27 chaos работает Physics Type Kinematic и корректно работает Collision response disabeled для колес

промежуточная демонстрация результата: 
https://youtu.be/fV5QxIVeGYw

Непонятно почему задние колеса блюрятся при зажатом газе на больших оборотах.

Пробовал реализовать движение руля через бп самостоятельно. изменив пивот для модели, но судя по всему придется работать с скелетом и добавлять руль в базу машины.

подтюнил физику, недоволен поворотом/заносами при торможении, но не буду отвелкаться
https://youtu.be/-LA0EMRPSDM

Следы торможения реализованы через is sleeping для всех колес. С текущим сетапом физики выглядит клево
https://youtu.be/sHypG6pcbaI

В процессе осознал что фар у болида нет, по этому сделал просто фонарь на кузове, чтобы продемонстрировать возможность. 
Задняя фара реализовал через замену материала. Инстанс с мультиплаем эмиссива.
Пофиксил джитер от моушн блюра на уровне консоли. Вероятно нужно будет переделывать под сборку.
https://youtu.be/p5SW8E6iIhg

Еще раз попробовал сделать поворот руля, не очень красиво, но работает. Надо дополишить.

**18.01**

* Задачи

Дотюнить руль == дотюнить физику транспорта, чтобы колеса не ходили так резко в некоторых кейсах.  

UI замены частей // 9:20 -> 10:00 ; 10:55 -> 11:50 ; 12:30 -> 14:00

UI управления, Смена камеры (tps, fps) // 10:00 -> 10:50

Сборка MVP, небольшая косметика // 14:00 ->

* Проблемы/решения

По хорошему замену частей делать через сокеты, но у меня нет правильного скелета для этого, по этому попробую сделать просто заменой ассетов.
Также есть подозрение что сокеты будут работать по пивоту, а пивот мешей в нулевой координате общего меша, что заставит переделывать пивоты всех мешей.

Столкнулся с проблемой set input mode UI only, в нем нет реакции на клавишу закрытия. тогл меню кастомизации нужно либо чуть по другому сделать, либо найти как решается этот кейс.
// решил проблему через disable input для pawn

Для сборки на 4.27 нужно vs 2019 :C 

как и думал, в сборке итоговой на колесах блюр, поищу способ пофиксить, вроде бы через постпроцессинг делается. 